---
title: "EXO1 : Enseigner la statistique avec R"
subtitle: "AFROMPA'R Bouaké 2025"
author: "Claude Grasland"
date: "2025-03-28"
date-format: iso
lang: fr
format:
  html:
    embed-resources: true
    smooth-scroll: true
    fontsize: 0.9em
    toc: true
    toc-depth: 3
    toc-title: "."
    crossrefs-hover: false
    css: custom.css
    theme: [yeti, style.scss]
    code-fold: true
execute:
  warning: false
  message: false 
knitr:
  opts_chunk:
    out.width: "100%"
editor_options: 
  chunk_output_type: console
editor: 
  markdown: 
    wrap: 72
---



On se propoe de montrer l'intérêt de R pour l'enseignement de la statistique aux étudiants de licence de géographie... Cet exercice correspond typiquement au travail qu'on pourrait donner à des étudiants de licence 2 ou 3 ayant suivi des cours de statistique univariée et bivariée et ayant des connaissances de base en cartographie thématique. 
 
On propose de réaliser une analyse de la distribution de l'Indicateur de Développement humain des régions de Côte d'Ivoire entre 2002 et 2022 à l'aide des données accessibles sur le site [Global Data Lab](https://globaldatalab.org/)  . Le programme est rédigé de telle sorte qu'on puisse facilement refaire l'exercice en prenant d'autres dates (ex. Evolution entre 2012 et 2022) ou d'autres pays d'Afrique de l'Ouest.

```{r}
library(sf)
library(dplyr)
```

## (1) PREPARATION DES DONNEES STATISTIQUES

-   **Consigne** : Après avoir chargé les fichiers *idh2002.csv* et *idh2022.csv*, construisez un tableau de donnée comportant le code et le nom des régions ainsi que leur population et leur indicateur de développement humain aux deux dates.

```{r}
# Importe les données
tab1<-read.table("data/exo_stats/idh1992.csv", 
                dec=".",
                sep = ";",
                header=TRUE)
tab2<-read.table("data/exo_stats/idh2022.csv", 
                dec=".", 
                sep=";",
                header=TRUE)

# Sélectionne les variables
tab1 <- tab1 %>% select(code=code, pays=pays, nom=nom, pop1992 = pop, idh1992 = idh)
tab2 <- tab2 %>% select(code=code,  pop2022 = pop, idh2022 = idh)

# Fusionne les deux tableaux
don <- left_join(tab1,tab2)


# Affiche
library(knitr)
kable(don, 
      main = "Tableau de départ")
```







{{< pagebreak >}}

## (2) STATISTIQUE UNIVARIEE

### Paramètres principaux

-   **Consigne** : Etudiez l'évolution  de l'IDH entre 1992 et 2022 en vous servant de paramètres principaux (valeurs centrales, paramètres de dispersion). Puis établissez deux histogrammes permettant de visualiser l'évolution.

```{r}
# sélectionne les variables
sel <- don[,c("idh1992","idh2022")]

# Tableau standard
quant<-apply(sel,2,quantile)
moy<-apply(sel,2,mean)
ect<-apply(sel,2,sd)
cv<-100*ect/moy
tab<-rbind(quant,moy,ect,cv)
row.names(tab) <-c("Minimum","Q1","Médiane","Q3","Maximum","Moyenne","Ecart-type", "C.V. (%)")

kable(tab, caption="Paramètres principaux", digits =2,
      col.names = c("Situation en 1992","Situation en 2022"),
      )
```


### Histogrammes

-   **Consigne** : Etablissez deux histogrammes permettant de visualiser la forme de la distribution de l'IDH en 1992 et en 2022

```{r, fig.width=8, fig.height=8}
par(mfrow=c(2,1))

mintot <-min(c(sel$idh1992, sel$idh2022))
maxtot <-max(c(sel$idh1992, sel$idh2022))

# Histogramme
hist(sel$idh1992,
     breaks=quantile(sel$idh1992),
     xlim=c(mintot,maxtot),
     col="gray80",
     main= "Situation en 1992",
     xlab = "IDH régional",
     ylab = "Fréquence moyenne")
rug(sel$idh1992, col="black", lwd=2)
lines(density(sel$idh1992), lty=3,lwd=2)

hist(sel$idh2022,
     breaks=quantile(sel$idh2022),
     xlim=c(mintot,maxtot),
     col="gray80",
     main= "Situation en 2022",
     xlab = "IDH régional",
     ylab = "Fréquence moyenne")
rug(sel$idh2022, col="black", lwd=2)
lines(density(sel$idh2022), lty=3,lwd=2)
```

{{< pagebreak >}}

## (3) PREPARATION DES DONNEES GEOMETRIQUES

-   **Consigne** : Après avoir chargé le fonds de carte affichez le contour des régions et  le code des unités.

```{r}
# Importe le fonds de carte
map <- st_read("data/exo_stats/mapreg.shp")

# Projette
map <- st_transform(map, 2042)


# Affichage du fonds de carte
par(mar=c(0,0,3,0))
plot(map$geometry, 
     col="gray90",
     main = "Code des unités spatiales de la zone d'étude")

# Ajout du code des unités spatiales
coo<-st_coordinates(st_centroid(map))
text(coo, map$code, cex=0.5,col="black",)

```

{{< pagebreak >}}

## (4) CARTOGRAPHIE THEMATIQUE


### Cartes de stock

-   **Consigne** : Réalisez deux cartes de stock décrivant le nombre d'habitants en 2002 et 2022 Vous utiliserez la même échelle de taille pour rendre les deux cartes comparables.


```{r}
library(mapsf)
map<-map[,c("code","geometry")]
map_don <- merge(map, don, by="code")

maxequ<-max(don$pop012,don$pop2022)

par(mfrow=c(1,2))
mf_map(map_don$geometry, col="white")
mf_map(map_don, type="prop", var="pop1992",
       val_max = maxequ, inches=0.1, col="gray20", 
       leg_title = "Population (milliers)",)
mf_layout(title="1992",frame = T, credits = "Source : Global Data Lab, 2025")

mf_map(map_don$geometry, col="white")
mf_map(map_don, type="prop", var="pop2022",
       val_max = maxequ, inches=0.1, col="gray20",
       leg_title = "Population (milliers)")
mf_layout(title="2022",frame = T, credits = "Source : Gloabl Data Lab 2025")


```


### Cartes de ratio (choroplèthes)

-   **Consigne** : Réalisez deux cartes de taux décrivant le niveau de l'IDH en 2002 et 2022. Pour les rendre comparables vous utiliserez dans chaque carte une partition en quartiles (4 classes d'effectifs égaux)


```{r}
library(mapsf)
map_don <- merge(map, don, by="code")
maxequ<-max(don$hdi2002,don$hdi2022)

par(mfrow=c(1,2))
mf_map(map_don, type="choro", var="idh1992",
       breaks = "quantile",nbreaks = 4, pal ="Grays",
       leg_title = "IDH",leg_val_rnd = 2)
mf_layout(title="1992",frame = T, credits = "Source : Global Data Lab, 2025")

mf_map(map_don, type="choro", var="idh2022",
       breaks = "quantile",nbreaks = 4, pal ="Grays",
       leg_title = "IDH",leg_val_rnd = 2)
mf_layout(title="2022",frame = T, credits = "Source : Global Data Lab, 2025")

```


{{< pagebreak >}}

## (5) STATISTIQUES BIVARIEES 

### Nuage de points

- **Consigne** : Tracez un nuage de point montrant l'évolution de l'indicateur de développement humain entre les deux dates.

```{r}
# prépration de l'analyse
code<-don$code
nom<-don$nom
X<-don$idh1992
Y<-don$idh2022
tab<-data.frame(code,nom,X,Y)

# Diagramme
plot(tab$X,tab$Y, 
     pch=20,
     cex=0.8,
     col="red",
     main = "Evolution de l'IDH",
     xlab="IDH 1992",
     ylab ="IDH 2022")
text(tab$X,tab$Y,tab$nom, 
     pos=2,
     cex=0.5,
     col="blue")



```

### Analyse de la corrélation

- **Consigne** : calculez les coefficients de corrélation de Pearson et Spearman et testez leur sgnificativité.

```{r}
cor.test(X,Y, method="pearson")
cor.test(X,Y, method="spearman")
```

### Droite de régression

- **Consigne** : calculez l'equation de la droite de régression et tracez- là sur le graphique.

```{r}
modreg <- lm(Y~X)
summary(modreg)
# Diagramme
plot(tab$X,tab$Y, 
     pch=20,
     cex=0.8,
     col="red",
     main = "Evolution de l'IDH",
     xlab="IDH 1992",
     ylab ="IDH 2022")
text(tab$X,tab$Y,tab$nom, 
     pos=2,
     cex=0.5,
     col="blue")

abline(modreg,col="black",lwd=1)

```

### Analyse des résidus

- **Consigne** : Calculez les valeurs théoriques prévus par le modèle de régression et les résidus. Affichez le tableau correspondant après l'avoir trié par ordre de résidus croissants.

```{r}
tab$Y_est <- modreg$fitted.values
tab$Y_res <- modreg$residuals
tab<-tab[order(tab$Y_res),]
kable(tab, digits=3)
```

### Cartographie des résidus

- **Consigne** : Cartographiez les résidus après les avoir standardisés.



```{r}
library(mapsf)

# Standardisation des résidus
tab$Y_res_std<-tab$Y_res/sd(tab$Y_res)

# Jointure avec la carte
map<-map[,c("code","geometry")]
map_reg <- merge(map, tab, by="code")

# Choix de la palette et des classes
library(RColorBrewer)
mypal<-brewer.pal(n = 6, name = "RdYlBu")
mybreaks = c(-10, -2,-1,0,1,2,10)

mf_map(map_reg, type="choro", var="Y_res_std",
       pal = mypal, breaks=mybreaks,
       leg_title = "Résidus standardisés",leg_val_rnd = 1)
mf_layout(title="Ecarts à la tendance 1992-2022",frame = T, credits = "Source : Global Data Lab, 2025")

```

{{< pagebreak >}}

## (6) ANALYSE SPATIALE

On se propose d'analyser l'effet de la distance à la capitale économique (Abidjan) ou politique (Yamoussoukro) sur l'évolution de lIDH entre 1992 et 2022 

### Distance aux deux capitales.

-   **Consigne** : ajoutez au tableau de données une colonne correspondant à la distance en km à Abidjan ou Yamoussoukro et faites en une cartographie en prenant comme bornes de classes 0, 100, 200, 300, 400, 500, 1000 km. 

```{r}
map_don$capeco<-0
map_don$capeco[1]<-1
capeco<-map_don[map_don$capeco==1,]
map_don$distcapeco<-1+as.numeric(st_distance(st_centroid(map_don),st_centroid(capeco)))/1000

map_don$cappol<-0
map_don$cappol[2]<-1
cappol<-map_don[map_don$cappol==1,]
map_don$distcappol<-1+as.numeric(st_distance(st_centroid(map_don),st_centroid(cappol)))/1000



# Choix de la palette et des classes
mypal<-brewer.pal(n = 7, name = "Greys")
mybreaks = c(0,100,200,300,400,500, 1000)

par(mfrow=c(1,2))
mf_map(map_don, type="choro", var="distcapeco",
       pal = mypal, breaks=mybreaks,
       leg_title = "en km",leg_val_rnd = 0)
mf_layout(title="Distance à la capitale économique",frame = T, credits = "Source : EE CIST 2025")

mf_map(map_don, type="choro", var="distcappol",
       pal = mypal, breaks=mybreaks,
       leg_title = "en km",leg_val_rnd = 0)
mf_layout(title="Distance à la capitale politique",frame = T, credits = "Source : EE CIST 2025")



```


### Relation entre développement et distance à la capitale

-   **Consigne** : Etudiez les corrélations entre l'IDH en 1992 (Y1) ou 2022 (Y2) et la distance à la capitale économique (X1) ou  politique (X2). Que pouvez-vous en conclure ?

```{r,fig.width=8,fig.height=8}
X1<-map_don$distcapeco
X2<-map_don$distcappol
Y1<-map_don$idh1992
Y2<-map_don$idh2022

par(mfrow=c(2,2))
plot(X1,Y1,main="Distance à Abidjan 1992", sub = round(cor(X1,Y1),3), pch=20)
abline(lm(Y1~X1),col="red")
plot(X2,Y1, main = "Distance à Yamoussoukro 1992",sub = round(cor(X2,Y1),3),pch=20)
abline(lm(Y1~X2),col="red")
plot(X1,Y2,main="Distance à Abidjan 2022", sub = round(cor(X1,Y2),3), pch=20)
abline(lm(Y2~X1),col="red")
plot(X2,Y2, main = "Distance à Yamoussoukro 2022",sub = round(cor(X2,Y2),3),pch=20)
abline(lm(Y2~X2),col="red")

```


